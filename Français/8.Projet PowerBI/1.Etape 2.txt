# ** √âtape 2 : Cr√©ation de Colonnes Calcul√©es et Mesures DAX *
 **Objectif :**  
 Ajouter **des colonnes calcul√©es** enrichissant l‚Äôanalyse et facilitant l‚Äôexploitation des donn√©es dans les rapports.  
 Cr√©er **des mesures DAX avanc√©es**, optimis√©es et corrig√©es, pour g√©n√©rer des KPIs pertinents.  

---

## ** 2.1. Colonnes Calcul√©es**  

 **Pourquoi ces colonnes calcul√©es ?**  
 Elles enrichissent les tables avec des informations **d√©riv√©es**, facilitant l'analyse.  
 Elles permettent d‚Äô**ajouter des classifications et des regroupements utiles** pour les rapports.  

---

### ** 1. Cat√©gorie de Promotion (DimPromotion)**
 **Explication :** Cette colonne classifie les promotions en fonction du pourcentage de remise appliqu√©.  
```DAX
DiscountCategory = 
SWITCH(TRUE(),
    DimPromotion[DiscountPercent] >= 50, "Tr√®s Forte",
    DimPromotion[DiscountPercent] >= 30, "Forte",
    DimPromotion[DiscountPercent] >= 10, "Mod√©r√©e",
    "Faible"
)
```
 **Utilisation :** Permet d‚Äôanalyser l‚Äôimpact des promotions par cat√©gorie dans les visuels.  

---

### ** 2. Classification des Produits par Gamme de Prix (FactSales)**
 **Correction :** Remplacement de `DimProduct[StandardCost]` par `FactSales[UnitPrice]`, qui est une donn√©e r√©elle du mod√®le.  
 **Explication :** Classe les produits en trois cat√©gories de prix en fonction de leur prix de vente.  
```DAX
PriceCategory = 
IF(FactSales[UnitPrice] > 400, "Premium",
    IF(FactSales[UnitPrice] > 200, "Moyenne Gamme", "Entr√©e de Gamme")
)
```
 **Utilisation :** Permet d‚Äôanalyser les tendances de vente par segment de prix.  

---

### **üîπ 3. Statut des Produits en Stock (FactSales)**
 **Explication :** Indique si un produit est encore disponible en stock ou en rupture.  
```DAX
ProductStatus = 
IF(FactSales[SalesQuantity] > 0, "En Stock", "Rupture")
```
 **Utilisation :** Peut √™tre utilis√© dans des **tableaux dynamiques et filtres interactifs**.  

---

### **üîπ 4. Nombre de Promotions Appliqu√©es (FactSales)**
 **Explication :** Identifie si une vente a b√©n√©fici√© d‚Äôune promotion ou non.  
```DAX
PromotionApplied = 
IF(ISBLANK(FactSales[PromotionKey]), "Non", "Oui")
```
 **Utilisation :** Permet d‚Äô√©valuer l‚Äôimpact des promotions sur les ventes.  

---

### **üîπ 5. Classification des Jours de Vente (DimDate)**
 **Correction :** `DateKey` √©tant stock√© sous le format **YYYYMMDD**, il faut extraire correctement la date avant d‚Äôappliquer `WEEKDAY()`.  
 **Explication :** Permet de cat√©goriser les jours en **Week-end** ou **Jour Ouvrable**.  
```DAX
DayCategory = 
VAR CorrectDate = 
    DATE(
        LEFT(DimDate[DateKey], 4), 
        MID(DimDate[DateKey], 5, 2), 
        RIGHT(DimDate[DateKey], 2)
    )
RETURN 
SWITCH(TRUE(),
    WEEKDAY(CorrectDate, 2) >= 6, "Week-end",
    "Jour Ouvrable"
)
```
 **Utilisation :** Filtrage et analyse des performances de ventes les jours ouvrables vs les week-ends.  

---

### **üîπ 6. Indicateur de Haute Saison (FactSales)**
 **Correction :** Extraction correcte du mois avant d‚Äôappliquer `MONTH()`.  
 **Explication :** Cette colonne identifie si une vente a √©t√© r√©alis√©e pendant une p√©riode de forte activit√© (ex : fin d‚Äôann√©e, soldes, promotions sp√©ciales).  
```DAX
HighSeason = 
VAR CorrectDate = 
    DATE(
        LEFT(FactSales[DateKey], 4), 
        MID(FactSales[DateKey], 5, 2), 
        RIGHT(FactSales[DateKey], 2)
    )
RETURN 
IF(
    MONTH(CorrectDate) IN {11, 12, 6, 7}, 
    "Haute Saison", 
    "Basse Saison"
)
```
 **Utilisation :** Analyse des performances des ventes en haute vs basse saison.  

---

### **üîπ 7. √âvaluation de la Remise Accord√©e (FactSales)**
 **Explication :** Cat√©gorise les transactions en fonction du montant de la remise appliqu√©e.  
```DAX
DiscountLevel = 
SWITCH(TRUE(),
    FactSales[DiscountAmount] = 0, "Aucune Remise",
    FactSales[DiscountAmount] < 50, "Remise Faible",
    FactSales[DiscountAmount] < 200, "Remise Moyenne",
    "Remise √âlev√©e"
)
```
 **Utilisation :** Permet d‚Äôanalyser l‚Äôeffet des promotions sur les volumes de ventes et les marges.  

---

## ** 2.2. Mesures DAX**  

 **Pourquoi utiliser des mesures ?**  
 Elles permettent de r√©aliser **des calculs dynamiques en fonction des visuels utilis√©s**.  
 Elles optimisent la performance en ne stockant pas de valeurs fixes.  

---

### **üîπ 1. Total des Ventes (FactSales)**
```DAX
TotalSales = SUMX(FactSales, FactSales[SalesQuantity] * FactSales[UnitPrice])
```
 **Indicateur cl√© pour tous les rapports de vente.**  

---

### **üîπ 2. Co√ªt Total des Produits Vendus (FactSales)**
```DAX
TotalCost = SUMX(FactSales, FactSales[SalesQuantity] * FactSales[UnitPrice] * 0.6)
```
 **Permet d‚Äô√©valuer la rentabilit√© en le comparant aux ventes totales.**  

---

### **üîπ 3. Marge B√©n√©ficiaire (FactSales)**
```DAX
ProfitMargin = DIVIDE(([TotalSales] - [TotalCost]), [TotalSales], 0)
```
 **Indicateur cl√© affich√© en **KPI ou en jauge (gauge chart)**.  

---

### **üîπ 4. Ventes apr√®s Remise (FactSales)**
```DAX
NetSales = [TotalSales] - SUM(FactSales[DiscountAmount])
```
 **Analyse des ventes avant et apr√®s application des remises.**  

---

### **üîπ 5. Contribution des Ventes par Cat√©gorie**
```DAX
SalesCategoryShare = 
DIVIDE(
    SUMX(FactSales, FactSales[SalesQuantity] * FactSales[UnitPrice]),
    CALCULATE(SUMX(FactSales, FactSales[SalesQuantity] * FactSales[UnitPrice]), ALL(DimCategory))
)
```
 **Permet de comparer les performances des diff√©rentes cat√©gories de produits.**  

---

### **üîπ 6. Montant des Ventes Moyennes par Client**
```DAX
AvgSalesPerCustomer = 
DIVIDE([TotalSales], DISTINCTCOUNT(FactSales[SalesKey]), 0)
```
 **Utilisation :** Indicateur cl√© affich√© en **KPI ou tableau comparatif**.  

---

### **üîπ 7. Impact des Promotions sur les Revenus**
```DAX
PromotionImpact = 
DIVIDE(
    SUMX(FactSales, FactSales[SalesQuantity] * FactSales[UnitPrice] - FactSales[DiscountAmount]),
    [TotalSales],
    0
)
```
 **Analyse de l‚Äôimpact des r√©ductions sur les ventes en **Graphique combin√©** (courbe + histogramme).  

---

 **Les indicateurs sont pr√™ts pour √™tre int√©gr√©s dans les rapports interactifs ! Veux-tu passer √† l‚Äô√âtape 3 (Cr√©ation des Rapports et Visualisations) ?**